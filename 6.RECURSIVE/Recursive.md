# Recursive

<img src=".Recursive_images/399f4161.png" width="500"/>

Рассмотрим задачу вычисления факториала числа. Факториал числа n определяется как:

n! = n * (n-1) * (n-2) * ... * 1
Используя рекурсию, мы можем определить функцию для вычисления факториала:

```py
def factorial(n):
    if n == 1:
        return 1
    else:
        return n * factorial(n-1)
```

В этой функции:

Базовый случай: если n равно 1, функция возвращает 1 (факториал 1 равен 1).
Рекурсивный случай: если n больше 1, функция вызывает саму себя с n-1 и умножает результат на n.
Функция продолжит вызывать саму себя, пока не достигнет базового случая. Затем она начнет возвращать значения, пока не
будет вычислено окончательное значение факториала.

Как ни странно, чтобы понять рекурсию, в PostgreSQL не надо понимать рекурсию. Потому что WITH RECURSIVE, который
присутствует в посгресе (и в других серьёзных базах) — это скорее вычисление чего-то итерациями до того, как будет
выполнено некоторое условие.
Тем не менее это очень полезный функционал базы, который можно использовать, например, чтобы вывести все подкатегории
заданной категории, если таблица задана в виде (id, parent_id, ...)

```sql
WITH RECURSIVE r AS (
    -- стартовая часть рекурсии 
    SELECT 1 AS i

    UNION ALL
    ----------------------


    -- рекурсивная часть
    SELECT i + 1 AS i
    FROM r
    WHERE i < 10)
-------------
SELECT *
FROM r;
```

> Если объяснить проще, то рекурсия в sql это последовательная обработка строка за строкой.
> В примере `стартовая часть рекурсии` это первая строка данных. Затем в следующих запросах будет
> вызываться `рекурсивная часть`, где мы будет прост обращаться к предыдущей строке(что не скажешь, если читать запрос).

Вот так можно представить запрос на псевдно языке

```
result[5]
for i in range(result.length):
    result[i]  = result[i - 1] + 1
```

1. Запустите запрос из примера
2. Попробуйте поменять споспоб ограничения через `LIMIT`
3. Запустите запрос в [ create_table.sql](%20create_table.sql)
4. А теперь найдите путь до КАИ
   > Чтобы соединить строки используй `||`
    ```sql
        prev_name || '->' || current_name 
    ```
   > Чтобы соспоставить айди и имена используй JOIN
   ```sql  
       JOIN prev_table ON table.parrent_id = prev_table.id
   ```

   Пример начала таблицы
   
   | id | parent_id | way |
   |-----|-----------|------------------------------------------|
   | 1 | 0 | Планета Земля |
   | 2 | 1 | Планета Земля->Континент Евразия |
   | 3 | 2 | Планета Земля->Континент Евразия->Европа |
   | ... | ... | ... |
      
